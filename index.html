<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Тест: Анализ и визуализация данных</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Unbounded:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --card: #1a1a26;
    --border: #2a2a3e;
    --accent: #7c3aed;
    --accent2: #06d6a0;
    --wrong: #ef4444;
    --text: #e2e8f0;
    --muted: #64748b;
    --correct-bg: #052e16;
    --wrong-bg: #2d0a0a;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(ellipse at 20% 20%, #7c3aed22 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, #06d6a022 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

.container { max-width: 800px; width: 100%; position: relative; z-index: 1; }

/* HEADER */
header { text-align: center; padding: 40px 0 30px; }
header h1 {
font-family: 'Unbounded', sans-serif;
font-size: clamp(1.4rem, 4vw, 2.2rem);
font-weight: 900;
background: linear-gradient(135deg, #7c3aed, #06d6a0);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
letter-spacing: -0.02em;
line-height: 1.2;
}
header p { color: var(--muted); margin-top: 10px; font-size: 0.85rem; }

/* PROGRESS */
.progress-bar-wrap {
background: var(--border);
border-radius: 100px;
height: 6px;
margin-bottom: 8px;
overflow: hidden;
}
.progress-bar-fill {
height: 100%;
background: linear-gradient(90deg, #7c3aed, #06d6a0);
border-radius: 100px;
transition: width 0.4s ease;
}
.progress-text {
display: flex;
justify-content: space-between;
font-size: 0.75rem;
color: var(--muted);
margin-bottom: 24px;
}
.score-live { color: var(--accent2); font-weight: 700; }

/* QUESTION CARD */
.question-card {
background: var(--card);
border: 1px solid var(--border);
border-radius: 16px;
padding: 28px;
margin-bottom: 16px;
animation: slideIn 0.3s ease;
}
@keyframes slideIn {
from { opacity: 0; transform: translateY(16px); }
to   { opacity: 1; transform: translateY(0); }
}
.q-number {
font-size: 0.7rem;
color: var(--accent);
font-weight: 700;
letter-spacing: 0.1em;
text-transform: uppercase;
margin-bottom: 12px;
}
.q-text {
font-size: clamp(0.9rem, 2.5vw, 1.05rem);
line-height: 1.7;
color: var(--text);
margin-bottom: 24px;
font-family: 'JetBrains Mono', monospace;
}

/* OPTIONS */
.options { display: flex; flex-direction: column; gap: 10px; }
.option {
background: var(--surface);
border: 1.5px solid var(--border);
border-radius: 10px;
padding: 14px 18px;
cursor: pointer;
transition: all 0.18s ease;
font-family: 'JetBrains Mono', monospace;
font-size: 0.88rem;
color: var(--text);
text-align: left;
line-height: 1.5;
position: relative;
overflow: hidden;
}
.option::before {
content: '';
position: absolute;
left: 0; top: 0; bottom: 0;
width: 3px;
background: var(--accent);
opacity: 0;
transition: opacity 0.2s;
}
.option:hover:not(:disabled) {
border-color: var(--accent);
background: #1e1e30;
transform: translateX(4px);
}
.option:hover:not(:disabled)::before { opacity: 1; }
.option:disabled { cursor: default; }

.option.correct {
background: var(--correct-bg);
border-color: var(--accent2);
color: var(--accent2);
transform: translateX(4px);
}
.option.correct::before { background: var(--accent2); opacity: 1; }
.option.wrong {
background: var(--wrong-bg);
border-color: var(--wrong);
color: var(--wrong);
}
.option.wrong::before { background: var(--wrong); opacity: 1; }
.option.disabled-grey {
opacity: 0.35;
}

.option.selected {
  background: var(--accent);
  border-color: var(--accent2);
  color: white;
  transform: translateX(4px);
}

/* FEEDBACK */
.feedback {
margin-top: 16px;
padding: 14px 18px;
border-radius: 10px;
font-size: 0.85rem;
font-weight: 700;
display: none;
align-items: center;
gap: 10px;
animation: popIn 0.25s ease;
}
@keyframes popIn {
from { transform: scale(0.95); opacity: 0; }
to   { transform: scale(1); opacity: 1; }
}
.feedback.show { display: flex; }
.feedback.correct-fb {
background: var(--correct-bg);
border: 1px solid var(--accent2);
color: var(--accent2);
}
.feedback.wrong-fb {
background: var(--wrong-bg);
border: 1px solid var(--wrong);
color: var(--wrong);
}
.feedback-icon { font-size: 1.3rem; flex-shrink: 0; }

/* NEXT BUTTON */
.btn-next {
margin-top: 20px;
width: 100%;
padding: 16px;
background: linear-gradient(135deg, var(--accent), #9f5ff5);
border: none;
border-radius: 10px;
color: #fff;
font-family: 'Unbounded', sans-serif;
font-size: 0.85rem;
font-weight: 700;
cursor: pointer;
display: none;
transition: opacity 0.2s, transform 0.2s;
letter-spacing: 0.05em;
}
.btn-next.show { display: block; }
.btn-next:hover { opacity: 0.9; transform: translateY(-2px); }

/* RESULT SCREEN */
.result-screen {
display: none;
text-align: center;
padding: 60px 20px;
animation: slideIn 0.4s ease;
}
.result-screen.show { display: block; }
.result-circle {
width: 160px; height: 160px;
border-radius: 50%;
background: conic-gradient(var(--accent2) var(--pct), var(--border) 0);
display: flex; align-items: center; justify-content: center;
margin: 0 auto 30px;
position: relative;
}
.result-circle::after {
content: '';
position: absolute;
width: 120px; height: 120px;
border-radius: 50%;
background: var(--card);
}
.result-score {
position: relative; z-index: 1;
font-family: 'Unbounded', sans-serif;
font-size: 2rem;
font-weight: 900;
color: var(--accent2);
}
.result-title {
font-family: 'Unbounded', sans-serif;
font-size: 1.5rem;
font-weight: 900;
margin-bottom: 12px;
background: linear-gradient(135deg, #7c3aed, #06d6a0);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}
.result-sub { color: var(--muted); font-size: 0.9rem; margin-bottom: 30px; line-height: 1.7; }
.btn-restart {
padding: 16px 40px;
background: linear-gradient(135deg, var(--accent), #06d6a0);
border: none; border-radius: 10px;
color: #fff;
font-family: 'Unbounded', sans-serif;
font-size: 0.85rem;
font-weight: 700;
cursor: pointer;
letter-spacing: 0.05em;
transition: opacity 0.2s;
}
.btn-restart:hover { opacity: 0.85; }

/* QUIZ AREA */
#quiz-area { display: block; }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>АНАЛИЗ И ВИЗУАЛИЗАЦИЯ ДАННЫХ</h1>
    <p>Тест · 109 вопросов · Мгновенная проверка ответов</p>
  </header>

  <div id="quiz-area">
    <div class="progress-bar-wrap">
      <div class="progress-bar-fill" id="progress-fill" style="width:0%"></div>
    </div>
    <div class="progress-text">
      <span id="progress-label">Вопрос 1 из 90</span>
      <span class="score-live" id="score-label">✓ 0</span>
    </div>

    <div class="question-card" id="question-card">
      <div class="q-number" id="q-number">ВОПРОС 01</div>
      <div class="q-text" id="q-text"></div>
      <div class="options" id="options"></div>
      <div class="feedback" id="feedback">
  <span class="feedback-icon" id="feedback-icon"></span>
  <span id="feedback-text"></span>
</div>
<button class="btn-submit-multi" id="btn-submit-multi" onclick="submitMulti()" style="display: none; margin-top: 20px; width: 100%; padding: 16px; background: linear-gradient(135deg, var(--accent2), #06d6a0); border: none; border-radius: 10px; color: #fff; font-family: 'Unbounded', sans-serif; font-size: 0.85rem; font-weight: 700; cursor: pointer; letter-spacing: 0.05em;">
  Подтвердить выбор →
</button>
<button class="btn-next" id="btn-next" onclick="nextQuestion()">
  Следующий вопрос →
</button>
    </div>
  </div>

  <div class="result-screen" id="result-screen">
    <div class="result-circle" id="result-circle">
      <div class="result-score" id="result-score"></div>
    </div>
    <div class="result-title" id="result-title"></div>
    <div class="result-sub" id="result-sub"></div>
    <button class="btn-restart" onclick="restartQuiz()">↺ Пройти заново</button>
  </div>
</div>

<script>
const questions = [
 // КОМПЕТЕНЦИЯ УК-1.1 (вопросы 1-13)
  { q: "1. Что является первым шагом в методике сбора информации для аналитической задачи?", opts: ["Построение графиков и дашборда", "Определение цели исследования и формулировка вопроса (что и зачем измеряем)", "Обучение модели на исторических данных", "Автоматическая очистка пропусков"], ans: 1 },
  { q: "2. Что в методологии анализа данных принято считать данными в их исходном, базовом понимании?", opts: ["Готовые аналитические отчёты и интерпретации", "Набор значений, измерений или записей, фиксирующих характеристики объектов, событий или процессов", "Визуальные представления информации: графики, диаграммы", "Информацию из публичных источников"], ans: 1 },
  { q: "3. Какие элементы обязательно входят в план сбора данных? (Выберите все верные)", opts: ["Определение целевой аудитории/объекта наблюдения", "Описание источников данных и способа получения", "Правила проверки качества", "Выбор цветовой схемы визуализаций", "Описание периода наблюдения и частоты обновления"], ans: 0, multi: [0,1,2,4] },
  { q: "4. В анализе данных под признаком (feature) понимают:", opts: ["Отдельный объект анализа", "Наблюдаемую или вычисляемую характеристику объекта, используемую как входная переменная", "Алгоритм или статистическую модель", "Визуальный компонент отчёта"], ans: 1 },
  { q: "5. Установите соответствие между типами аналитики и их вопросами: А) Описательная, Б) Диагностическая, В) Прогнозная, Г) Предписывающая.", opts: [
    "А-«Как распределились продажи?», Б-«Почему упала прибыль?», В-«Сколько клиентов уйдёт?», Г-«Что делать?»",
    "А-«Почему упала прибыль?», Б-«Что делать?», В-«Как распределились продажи?», Г-«Сколько клиентов уйдёт?»",
    "А-«Что делать?», Б-«Сколько клиентов уйдёт?», В-«Почему упала прибыль?», Г-«Как распределились продажи?»",
    "А-«Сколько клиентов уйдёт?», Б-«Как распределились продажи?», В-«Что делать?», Г-«Почему упала прибыль?»"
  ], ans: 0 },
  { q: "6. Почему важно учитывать контекст сбора данных (период, методику, изменения в процессах)?", opts: ["Чтобы улучшить визуальное оформление отчёта", "Чтобы снизить риск неверной интерпретации из-за смещений и смены методологии", "Чтобы ускорить работу дашборда", "Потому что большой объём данных гарантирует корректность выводов"], ans: 1 },
  { q: "7. В табличном наборе данных (DataFrame) что называют наблюдением (observation)?", opts: ["Столбец с признаком", "Одну строку, соответствующую одному объекту/событию", "Модель машинного обучения", "График распределения признака"], ans: 1 },
  { q: "8. Как корректнее всего определить целевую переменную (target) в задаче обучения с учителем?", opts: ["Любой категориальный признак", "Переменная, которую модель должна предсказать (выход)", "Любой числовой признак после нормализации", "Идентификатор строки (index)"], ans: 1 },
  { q: "9. Компания оценивает удовлетворённость по отзывам только от пользователей, написавших в поддержку. Какой риск наиболее типичен?", opts: ["Риск нарушения нормализации данных", "Риск смещения выборки (selection bias)", "Риск переобучения модели", "Риск увеличения точности (accuracy)"], ans: 1 },
  { q: "10. Что является корректной формулировкой цели аналитического исследования?", opts: ["«Сделать красивый дашборд»", "«Понять всё про пользователей»", "«Оценить влияние скидки 10% на конверсию за 4 недели»", "«Собрать побольше данных»"], ans: 2 },
  { q: "11. Установите соответствие между источниками информации и рисками: 1) Опрос пользователей, 2) Логи событий, 3) Внешние данные, 4) Экспертная оценка.", opts: [
    "1-самоотбор, 2-потери событий, 3-смена методики, 4-субъективность",
    "1-субъективность, 2-самоотбор, 3-потери событий, 4-смена методики",
    "1-смена методики, 2-субъективность, 3-самоотбор, 4-потери событий",
    "1-потери событий, 2-смена методики, 3-субъективность, 4-самоотбор"
  ], ans: 0 },
  { q: "12. Какой тезис описывает принцип воспроизводимости аналитического результата?", opts: ["Результат понравился заказчику", "При тех же данных и шагах получается тот же вывод", "Данных много", "Использовалась сложная модель"], ans: 1 },
  { q: "13. Почему опасно делать обобщения без сегментации?", opts: ["Так нельзя в Pandas", "Эффект агрегирования/парадокс Симпсона", "Среднее всегда равно медиане", "Визуализация станет сложнее"], ans: 1 },

  // КОМПЕТЕНЦИЯ УК-1.2 (вопросы 14-25)
  { q: "14. Какая последовательность этапов наиболее соответствует жизненному циклу анализа данных?", opts: ["Сбор → Анализ → Визуализация → Очистка", "Сбор → Подготовка и очистка → Анализ → Интерпретация", "Формулирование гипотезы → Построение модели → Сбор данных", "Сбор → Формулирование выводов → Подготовка данных"], ans: 1 },
  { q: "15. Установите последовательность первичной обработки данных: 1) Очистка данных, 2) Удаление дубликатов, 3) Анализ пропусков, 4) Проверка типов данных, 5) Финальная проверка.", opts: ["4→3→2→1→5", "1→2→3→4→5", "3→4→2→1→5", "2→3→4→1→5"], ans: 0 },
  { q: "16. Установите последовательность этапов аналитического проекта: А) постановка цели, Б) сбор данных, В) анализ, Г) интерпретация, Д) подготовка данных.", opts: ["А→Б→Д→В→Г", "А→Б→В→Г→Д", "Б→А→В→Г→Д", "А→Д→Б→В→Г"], ans: 0 },
  { q: "17. Установите соответствие между типами визуализации и задачами: А) Гистограмма, Б) Столбчатая, В) Линейный график, Г) Диаграмма рассеяния.", opts: [
    "А-распределение, Б-сравнение категорий, В-динамика, Г-взаимосвязь",
    "А-сравнение, Б-распределение, В-взаимосвязь, Г-динамика",
    "А-динамика, Б-взаимосвязь, В-распределение, Г-сравнение",
    "А-взаимосвязь, Б-динамика, В-сравнение, Г-распределение"
  ], ans: 0 },
  { q: "18. Для быстрого сравнения выручки по 15 категориям какой тип визуализации наиболее эффективен?", opts: ["Круговая диаграмма", "Столбчатая диаграмма с сортировкой по убыванию", "Диаграмма рассеяния", "Гистограмма"], ans: 1 },
  { q: "19. Установите последовательность для получения среднего чека по регионам: 1) группировка, 2) расчёт среднего, 3) аудит данных, 4) анализ.", opts: ["3→1→2→4", "1→2→3→4", "2→1→3→4", "4→3→2→1"], ans: 0 },
  { q: "20. В столбце «Сумма покупки» обнаружены выбросы. Какие шаги предпринять? (Выберите все верные)", opts: ["Проверить техническую корректность", "Изучить бизнес-контекст", "Немедленно исключить по IQR", "Сравнить результаты с выбросами и без"], ans: 0, multi: [0,1,3] },
  { q: "21. При подключении стороннего дата-сета что обязательно проверить? (Выберите все верные)", opts: ["Происхождение и методологию", "Временные характеристики", "Наличие определений метрик", "Визуальное оформление", "Наличие систематических искажений"], ans: 0, multi: [0,1,2,4] },
  { q: "22. После обучения: accuracy train=0.95, test=0.65. Какой шаг корректен?", opts: ["Принять результаты", "Провести диагностику, упростить модель", "Улучшить визуализацию", "Игнорировать тестовую выборку"], ans: 1 },
  { q: "23. Какие два утверждения верны для ситуации accuracy train=0.94, test=0.62? (Выберите два)", opts: ["Модель имеет высокую обобщающую способность", "Это признак переобучения", "Следует использовать кросс-валидацию", "Метрики precision не нужны"], ans: 1, multi: [1,2] },
  { q: "24. Установите соответствие между этапами аналитического цикла и результатами: А) формулировка задачи, Б) сбор данных, В) предобработка, Г) анализ, Д) оценка.", opts: [
    "А-бизнес-вопросы, Б-исходный набор, В-очищенные данные, Г-графики и инсайты, Д-метрики качества",
    "А-метрики, Б-графики, В-исходный набор, Г-очищенные данные, Д-бизнес-вопросы",
    "А-исходный набор, Б-бизнес-вопросы, В-метрики, Г-очищенные данные, Д-графики",
    "А-графики, Б-метрики, В-бизнес-вопросы, Г-исходный набор, Д-очищенные данные"
  ], ans: 0 },
  { q: "25. Вы сравнили метрику в CRM и BI — расхождение 12%. Какие проверки нужны? (Выберите все верные)", opts: ["Проверить определение 'заказ'", "Проверить период и часовой пояс", "Принять BI как истину", "Проверить фильтры", "Проверить актуальность"], ans: 0, multi: [0,1,3,4] },

  // КОМПЕТЕНЦИЯ УК-1.3 (вопросы 26-30)
  { q: "26. Что методически правильнее при работе с несколькими источниками с разными определениями?", opts: ["Усреднить значения", "Зафиксировать определения и описать преобразование", "Использовать источник с красивыми данными", "Игнорировать расхождения"], ans: 1 },
  { q: "27. Установите соответствие между артефактами и их назначением: 1) Протокол обработки, 2) Журнал изменений, 3) Матрица гипотез, 4) Карта стейкхолдеров.", opts: [
    "1-фиксирует преобразования, 2-фиксирует изменения версий, 3-связывает гипотезы, 4-описывает границы системы",
    "1-изменения версий, 2-преобразования, 3-границы системы, 4-связь гипотез",
    "1-связь гипотез, 2-границы системы, 3-преобразования, 4-изменения версий",
    "1-границы системы, 2-связь гипотез, 3-изменения версий, 4-преобразования"
  ], ans: 0 },
  { q: "28. Если внешний датасет обновляется, какова корректная практика?", opts: ["Всегда брать последнюю версию", "Зафиксировать версию/дату среза", "Не использовать внешние данные", "Использовать разные версии"], ans: 1 },
  { q: "29. Что является корректной практикой при удалении данных в ходе очистки?", opts: ["Удалять всё без фиксации", "Заранее определить критерии и документировать", "Удалять только в тестовой выборке", "Удалять до проверки качества"], ans: 1 },
  { q: "30. Как подтвердить, что результат анализа не случаен?", opts: ["Построить больше графиков", "Повторить анализ с разными допущениями", "Увеличить количество строк дублированием", "Исключить все данные с пропусками"], ans: 1 },

  // КОМПЕТЕНЦИЯ ОПК-2.1 (вопросы 31-36)
  { q: "31. Какой класс ПО применяют для управленческой отчётности?", opts: ["BI-платформы", "IDE для разработки", "Системы контроля версий", "Редакторы изображений"], ans: 0 },
  { q: "32. Какая система отвечает за учёт товаров и складских остатков?", opts: ["ERP-система", "CRM-система", "BI-платформа", "СЭД"], ans: 0 },
  { q: "33. Какие источники подключают к BI для аналитики? (Выберите все верные)", opts: ["CRM/ERP", "Web-аналитика", "Хранилище данных", "Плейлист в музыкальном сервисе", "Служба поддержки"], ans: 0, multi: [0,1,2,4] },
  { q: "34. Какова роль API-интеграции?", opts: ["Обмен данными по контракту", "Сохранение файлов на диск", "Дизайн интерфейса", "Печать документов"], ans: 0 },
  { q: "35. Установите соответствие: 1) BI-платформа, 2) CRM, 3) ERP, 4) Service Desk.", opts: [
    "1-дашборды, 2-лиды и сделки, 3-склад и финансы, 4-обращения пользователей",
    "1-обращения, 2-дашборды, 3-лиды, 4-склад",
    "1-склад, 2-обращения, 3-дашборды, 4-лиды",
    "1-лиды, 2-склад, 3-обращения, 4-дашборды"
  ], ans: 0 },
  { q: "36. Какая практика наиболее корректна в бизнес-аналитике?", opts: ["Считать метрики 'как получится'", "Фиксировать определения метрик и источники", "Использовать разные формулы в каждом отчёте", "Никогда не обновлять данные"], ans: 1 },

  // КОМПЕТЕНЦИЯ ОПК-2.2 (вопросы 37-48)
  { q: "37. При выборе BI для устаревшей инфраструктуры важнейший критерий?", opts: ["Совместимость и минимальные требования", "Сложная анимация", "Лидерство в рейтингах", "Встроенные функции ML"], ans: 0 },
  { q: "38. Установите соответствие: 1) рост пользователей, 2) восстановление после сбоя, 3) интеграция с 1С, 4) импортозамещение.", opts: [
    "1-масштабируемость, 2-резервное копирование, 3-коннекторы, 4-реестр РФ",
    "1-коннекторы, 2-масштабируемость, 3-реестр РФ, 4-резервное копирование",
    "1-реестр РФ, 2-коннекторы, 3-резервное копирование, 4-масштабируемость",
    "1-резервное копирование, 2-реестр РФ, 3-масштабируемость, 4-коннекторы"
  ], ans: 0 },
  { q: "39. Ситуация: отечественная BI дороже, но с поддержкой ФЗ-152. Что выбрать?", opts: ["Зарубежную, дешевле", "Отечественную, снижает риски", "Оба решения", "Отказаться от BI"], ans: 1 },
  { q: "40. Почему важна документация при выборе ПО?", opts: ["Для красивого дизайна", "Ускорить внедрение и снизить зависимость", "По ГОСТу", "Увеличить отчётность"], ans: 1 },
  { q: "41. Какие действия снижают риски при выборе ПО? (Выберите все верные)", opts: ["Проверка сообщества", "Оценка планов вендора", "Выбор по демо-видео", "Тестирование PoC", "Игнорирование отзывов"], ans: 0, multi: [0,1,3] },
  { q: "42. Что использовать для аналитической витрины с контролем доступа?", opts: ["Excel на сетевом диске", "CSV в облаке", "Серверную СУБД", "Хранение в BI"], ans: 2 },
  { q: "43. При политике импортозамещения что нужно проверить?", opts: ["Наличие в реестре РФ", "Количество графиков", "Место в рейтингах", "Личные предпочтения"], ans: 0 },
  { q: "44. Какие критерии ключевые для крупного предприятия? (Выберите все верные)", opts: ["Интеграция", "TCO", "Безопасность и RBAC", "Эстетика UI", "Масштабируемость"], ans: 0, multi: [0,1,2,4] },
  { q: "45. Установите последовательность этапов выбора BI: А) пилот, Б) формулирование требований, В) принятие решения, Г) анализ рынка.", opts: ["Б→Г→А→В", "А→Б→В→Г", "Г→Б→А→В", "Б→А→Г→В"], ans: 0 },
  { q: "46. Установите соответствие: 1) гибкость и масштабирование, 2) конфиденциальные данные, 3) отсутствие DevOps.", opts: [
    "1-облако, 2-on-premise, 3-облако",
    "1-on-premise, 2-облако, 3-on-premise",
    "1-облако, 2-облако, 3-on-premise",
    "1-on-premise, 2-on-premise, 3-облако"
  ], ans: 0 },
  { q: "47. При выборе аналитической платформы какой подход отражает принцип рационального выбора?", opts: ["Следование трендам", "Оптимизация по одному критерию", "Комплексная оценка с пилотом", "Максимизация сложности"], ans: 2 },
  { q: "48. Какой первый шаг при разработке дашборда из Excel и SQL с разграничением доступа?", opts: ["Проектировать интерфейс", "Формализовать требования", "Написать скрипт", "Объединять вручную"], ans: 1 },

  // КОМПЕТЕНЦИЯ ОПК-2.3 (вопросы 49-60)
  { q: "49. Установите последовательность проектирования дашборда: А) анализ потребностей, Б) KPI, В) логическая модель, Г) интерфейс, Д) прототип.", opts: ["А→Б→В→Г→Д", "Б→А→В→Г→Д", "А→В→Б→Г→Д", "В→А→Б→Г→Д"], ans: 0 },
  { q: "50. Что означает «публикация дашборда» в корпоративной среде?", opts: ["Вывод на печать", "Размещение без прав доступа", "Развёртывание с настройкой ролей и расписания", "Сохранение на локальном ПК"], ans: 2 },
  { q: "51. Для отчёта из Excel и CRM какие источники нужны? (Выберите все верные)", opts: ["CSV/Excel", "Реляционные БД", "ERP-система", "PNG/растровые файлы", "Облачные API"], ans: 0, multi: [0,1,2,4] },
  { q: "52. Что такое матрица дашборда?", opts: ["Таблица для оценки ML-модели", "Документ с KPI, визуализациями и ролями", "Математический объект", "Документ о визуальном стиле"], ans: 1 },
  { q: "53. Что такое drill-down?", opts: ["Масштабирование интерфейса", "Иерархическая навигация от общего к детальному", "Сброс фильтров", "Смена темы"], ans: 1 },
  { q: "54. Цель навигационной структуры в дашборде?", opts: ["Повышение визуальной плотности", "Логическая организация информации", "Ограничение видимости", "Замена KPI на текст"], ans: 1 },
  { q: "55. Стандарт для отображения динамики во времени?", opts: ["Линейный график", "Круговая диаграмма", "Диаграмма Санкей", "Таблица"], ans: 0 },
  { q: "56. Что относится к настройке доступа в BI? (Выберите все верные)", opts: ["RBAC", "RLS", "Выбор цветовой темы", "Настройка расписания"], ans: 0, multi: [0,1] },
  { q: "57. Цель вычисляемых полей (measures) в BI?", opts: ["Безопасность", "Динамический расчёт метрик", "Замена источников данных", "Очистка данных"], ans: 1 },
  { q: "58. Установите соответствие: 1) Водопадная диаграмма, 2) Диаграмма Санкей, 3) Линейный график, 4) Ящик с усами.", opts: [
    "1-декомпозиция, 2-потоки, 3-динамика, 4-распределение",
    "1-динамика, 2-декомпозиция, 3-потоки, 4-распределение",
    "1-потоки, 2-распределение, 3-декомпозиция, 4-динамика",
    "1-распределение, 2-динамика, 3-потоки, 4-декомпозиция"
  ], ans: 0 },
  { q: "59. Что включается в матрицу дашборда? (Выберите все верные)", opts: ["Спецификация метрик", "Анализ пользователей", "Модель разрезов", "Дизайн-гайдлайн", "Спецификация источников"], ans: 0, multi: [0,1,2,4] },
  { q: "60. Установите соответствие: 1) конфиденциальность, 2) актуальность, 3) детализация, 4) расчёт метрик.", opts: [
    "1-RLS, 2-расписание обновления, 3-drill-down, 4-меры",
    "1-меры, 2-RLS, 3-расписание, 4-drill-down",
    "1-drill-down, 2-меры, 3-RLS, 4-расписание",
    "1-расписание, 2-drill-down, 3-меры, 4-RLS"
  ], ans: 0 },

  // КОМПЕТЕНЦИЯ ОПК-6.1 (вопросы 61-81)
  { q: "61. Шкала без естественного порядка (пол, город) называется __________.", opts: ["номинальной", "порядковой", "интервальной", "относительной"], ans: 0 },
  { q: "62. Какие показатели — меры центральной тенденции? (Выберите все верные)", opts: ["Медиана", "Среднее", "Дисперсия", "Мода", "IQR"], ans: 0, multi: [0,1,3] },
  { q: "63. Корреляция X и Y статистически значима. Что верно?", opts: ["X вызывает Y", "Согласованное изменение, но не причина", "Данные без ошибок", "X точно предсказывает Y"], ans: 1 },
  { q: "64. Таблица с TP, FP, FN, TN называется __________.", opts: ["матрицей ошибок", "таблицей сопряжённости", "корреляционной матрицей", "таблицей ковариаций"], ans: 0 },
  { q: "65. Медиана набора 12, 15, 15, 16, 100?", opts: ["12", "15", "16", "100"], ans: 1 },
  { q: "66. Команда для загрузки CSV в Pandas?", opts: ["pd.open_csv()", "pd.read_csv()", "df.load_csv()", "pd.import_csv()"], ans: 1 },
  { q: "67. Что делает df.groupby('region')['revenue'].sum()?", opts: ["Сортирует", "Сумму по регионам", "Удаляет пропуски", "Объединяет"], ans: 1 },
  { q: "68. df.shape возвращает?", opts: ["Названия столбцов", "Количество пропусков", "(число строк, число столбцов)", "Типы данных"], ans: 2 },
  { q: "69. Какая команда завершает построение графика в Matplotlib?", opts: ["plt.render()", "plt.show()", "plt.draw_all()", "plt.open()"], ans: 1 },
  { q: "70. Что подходит для анализа распределения?", opts: ["plt.hist()", "plt.plot()", "plt.pie()", "plt.imshow()"], ans: 0 },
  { q: "71. df.dtypes показывает?", opts: ["Первые 5 строк", "Типы данных столбцов", "Количество пропусков", "Число уникальных значений"], ans: 1 },
  { q: "72. Как получить названия столбцов?", opts: ["df.columns", "df.rows", "df.header()", "df.colnames()"], ans: 0 },
  { q: "73. Установите соответствие: 1) df.dropna(), 2) df.fillna(), 3) df.drop_duplicates(), 4) df.isna().", opts: [
    "1-удаление строк с NaN, 2-заполнение NaN, 3-удаление дубликатов, 4-маска пропусков",
    "1-заполнение NaN, 2-удаление строк, 3-маска пропусков, 4-удаление дубликатов",
    "1-маска пропусков, 2-удаление дубликатов, 3-заполнение NaN, 4-удаление строк",
    "1-удаление дубликатов, 2-маска пропусков, 3-удаление строк, 4-заполнение NaN"
  ], ans: 0 },
  { q: "74. Чтобы подписать ось X, используют plt.______()", opts: ["xlabel", "title", "ylabel", "legend"], ans: 0 },
  { q: "75. Как из '1 250,50' получить число?", opts: ["astype(int)", "удалить столбец", "заменить пробелы и запятые, затем float", "fillna(0)"], ans: 2 },
  { q: "76. После merge появилось много NaN. Первое действие?", opts: ["Заменить на 0", "Проверить ключи и совпадения", "Удалить строки с NaN", "Игнорировать"], ans: 1 },
  { q: "77. Последовательность построения графика: 1) данные, 2) график, 3) подписи, 4) вывод.", opts: ["1→2→3→4", "2→1→3→4", "1→3→2→4", "3→1→2→4"], ans: 0 },
  { q: "78. Метод для реляционного соединения в Pandas?", opts: ["concat", "merge", "join", "append"], ans: 1 },
  { q: "79. Как построить горизонтальную столбчатую?", opts: ["plt.barh()", "plt.hbar()", "plt.bar(horizontal=True)", "plt.hist()"], ans: 0 },
  { q: "80. Что улучшает читаемость графика?", opts: ["plt.grid(True)", "plt.map()", "plt.axis()", "plt.mesh()"], ans: 0 },
  { q: "81. Что делать с NaN перед обучением sklearn?", opts: ["Преобразовать в строку", "Удалить целевую переменную", "Обработать пропуски до обучения", "Игнорировать"], ans: 2 },

  // КОМПЕТЕНЦИЯ ОПК-6.2 (вопросы 82-105)
  { q: "82. Установите соответствие: А) прогноз стоимости, Б) определение оттока, В) сегментация.", opts: [
    "А-регрессия, Б-классификация, В-кластеризация",
    "А-классификация, Б-кластеризация, В-регрессия",
    "А-кластеризация, Б-регрессия, В-классификация",
    "А-классификация, Б-регрессия, В-кластеризация"
  ], ans: 0 },
  { q: "83. Основная цель кросс-валидации?", opts: ["Увеличить выборку", "Оценка обобщающей способности", "Повысить производительность", "Упростить интерпретацию"], ans: 1 },
  { q: "84. Стандартные шаги предобработки для ML? (Выберите все верные)", opts: ["Дедупликация", "Обработка пропусков", "Масштабирование", "Подбор цветов", "Кодирование категорий"], ans: 0, multi: [0,1,2,4] },
  { q: "85. 3% пропусков в «Возрасте». Что делать?", opts: ["Удалить все с пропусками", "Заполнить медианой по группе и проверить", "Заменить на 0", "Анализ без изменений"], ans: 1 },
  { q: "86. Установите соответствие: I) дубликаты, II) некорректные значения, III) пропуски.", opts: [
    "I-удаление дубликатов, II-валидация, III-импутация",
    "I-импутация, II-удаление дубликатов, III-валидация",
    "I-валидация, II-импутация, III-удаление дубликатов",
    "I-импутация, II-валидация, III-удаление дубликатов"
  ], ans: 0 },
  { q: "87. Подход к обработке выбросов?", opts: ["Удалить все", "Исследовать происхождение", "Продолжить без изменений", "Исключить признак"], ans: 1 },
  { q: "88. Accuracy(доля верно классифицированных объектов) при True Positive = 40, False Positive = 10, False Negative = 5, True Negative = 45?", opts: ["0,70", "0,80", "0,85", "0,90"], ans: 2 },
  { q: "89. Установите соответствие: 1) прогноз выручки, 2) мошенничество, 3) прогноз пола.", opts: [
    "1-MAE/MSE/R², 2-Precision/Recall/F1, 3-Accuracy/ROC-AUC",
    "1-Accuracy/ROC-AUC, 2-MAE/MSE/R², 3-Precision/Recall/F1",
    "1-Precision/Recall/F1, 2-Accuracy/ROC-AUC, 3-MAE/MSE/R²",
    "1-MAE/MSE/R², 2-Accuracy/ROC-AUC, 3-Precision/Recall/F1"
  ], ans: 0 },
  { q: "90. Установите соответствие: 1) KPI, 2) вычисляемое поле, 3) модель данных, 4) ETL.", opts: [
    "1-показатель цели, 2-динамический расчёт, 3-семантический слой, 4-извлечение/загрузка",
    "1-динамический расчёт, 2-семантический слой, 3-извлечение, 4-показатель",
    "1-семантический слой, 2-извлечение, 3-показатель, 4-динамический расчёт",
    "1-извлечение, 2-показатель, 3-динамический расчёт, 4-семантический слой"
  ], ans: 0 },
  { q: "91. Что содержит фактовая таблица в звёздной схеме?", opts: ["Описательные атрибуты", "Численные показатели и внешние ключи", "Классификаторы", "Только даты"], ans: 1 },
  { q: "92. Последовательность подготовки к обучению: 1) разделить, 2) пропуски, 3) X и y, 4) обучить, 5) оценить.", opts: ["2→3→1→4→5", "1→2→3→4→5", "3→2→1→4→5", "2→1→3→4→5"], ans: 0 },
  { q: "93. Прогноз стоимости доставки (число) — это?", opts: ["Классификация", "Регрессия", "Кластеризация", "Ранжирование"], ans: 1 },
  { q: "94. Установите соответствие: 1) LinearRegression, 2) LogisticRegression, 3) KMeans, 4) DecisionTree.", opts: [
    "1-с учителем, 2-с учителем, 3-без учителя, 4-с учителем",
    "1-без учителя, 2-с учителем, 3-с учителем, 4-без учителя",
    "1-с учителем, 2-без учителя, 3-с учителем, 4-без учителя",
    "1-без учителя, 2-без учителя, 3-с учителем, 4-с учителем"
  ], ans: 0 },
  { q: "95. Признаки переобучения? (Выберите все верные)", opts: ["Train > test", "Train = test высокое", "Test падает при усложнении", "Разные результаты на CV"], ans: 0, multi: [0,2,3] },
  { q: "96. Что такое недообучение?", opts: ["Train высокое, test низкое", "Низкое и train, и test", "Test выше train", "Нет гиперпараметров"], ans: 1 },
  { q: "97. Что такое Pipeline в scikit-learn?", opts: ["Хранит данные", "Объединяет предобработку и модель", "Тип графика", "Рисует дашборды"], ans: 1 },
  { q: "98. Установите соответствие: 1) Precision, 2) Recall, 3) Accuracy, 4) MAE.", opts: [
    "1-TP/(TP+FP), 2-TP/(TP+FN), 3-доля верных, 4-средняя ошибка",
    "1-TP/(TP+FN), 2-TP/(TP+FP), 3-средняя ошибка, 4-доля верных",
    "1-доля верных, 2-средняя ошибка, 3-TP/(TP+FP), 4-TP/(TP+FN)",
    "1-средняя ошибка, 2-доля верных, 3-TP/(TP+FN), 4-TP/(TP+FP)"
  ], ans: 0 },
  { q: "99. Последовательность: 1) признаки, 2) X и y, 3) разделить, 4) обучить, 5) оценить.", opts: ["1→2→3→4→5", "2→1→3→4→5", "3→1→2→4→5", "1→3→2→4→5"], ans: 0 },
  { q: "100. Train высокое, test низкое. Что делать?", opts: ["Усложнить модель", "Проверить утечки, упростить", "Удалить test", "Построить круговую"], ans: 1 },
  { q: "101. Как избежать утечки при масштабировании?", opts: ["На всём датасете", "После разделения, обучать на train", "Только на test", "Не делать"], ans: 1 },
  { q: "102. Минимум для сравнения двух моделей?", opts: ["Train-метрика", "Одинаковое разбиение и одна метрика на test", "Скорость работы", "Красота графиков"], ans: 1 },
  { q: "103. Train высокое, test низкое. Следующий шаг?", opts: ["Усложнить", "Кросс-валидация и упрощение", "Удалить test", "Заменить scatter на pie"], ans: 1 },
  { q: "104. В задаче 'купит ли клиент' признаки и цель?", opts: ["X = bought, y = age", "X = age, city, visits, y = bought", "X = все, y не нужен", "X = age, y = city"], ans: 1 },
  { q: "105. Какой алгоритм для кластеризации клиентов без меток?", opts: ["KMeans", "LogisticRegression", "LinearRegression", "DecisionTree"], ans: 0 },

  // КОМПЕТЕНЦИЯ ОПК-6.3 (вопросы 106-109)
  { q: "106. Установите соответствие: 1) теоретическая подготовка, 2) экспериментальная, 3) интерпретация.", opts: [
    "1-анализ решений и гипотеза, 2-реализация и расчёты, 3-оценка значимости",
    "1-реализация, 2-оценка, 3-анализ",
    "1-оценка, 2-анализ, 3-реализация",
    "1-реализация, 2-анализ, 3-оценка"
  ], ans: 0 },
  { q: "107. Как объективно сравнить две модели?", opts: ["Разные тестовые выборки", "Одна предобработка и единая тестовая выборка", "По числу параметров", "По времени обучения"], ans: 1 },
  { q: "108. Последовательность исследования: 1) данные, 2) вопрос, 3) интерпретация, 4) метод, 5) расчёты.", opts: ["2→1→4→5→3", "1→2→4→5→3", "2→4→1→5→3", "1→4→2→5→3"], ans: 0 },
  { q: "109. Этичное исследование? (Выберите все верные)", opts: ["Прозрачное документирование", "Скрытие неудобных результатов", "Учёт побочных эффектов", "Использование данных по назначению", "Преувеличение значимости"], ans: 0, multi: [0,2,3] }
];

let answeredQuestions = {}; // { index: { chosen, correct, isCorrect } }
let score = 0;
let current = 0;
let answered = false;
let selectedMulti = [];
let isMulti = false;
let userAnswers = [];
let userAnswersDetails = [];

// Загружаем сохранённый прогресс
(function loadProgress() {
  try {
    const saved = JSON.parse(sessionStorage.getItem('quizProgress'));
    if (saved) {
      answeredQuestions = saved.answeredQuestions || {};
      score = saved.score || 0;
      current = saved.current || 0;
    }
  } catch(e) {}
})();

function saveQuiz() {
  try {
    sessionStorage.setItem('quizProgress', JSON.stringify({
      answeredQuestions, score, current
    }));
  } catch(e) {}
}

function renderQuestion() {
  const q = questions[current];
  answered = false;
  selectedMulti = [];
  isMulti = Array.isArray(q.multi);

  document.getElementById('q-number').textContent = `ВОПРОС ${String(current+1).padStart(2,'0')}`;
  document.getElementById('q-text').innerHTML = q.q.replace(/\n/g, '<br>');
  document.getElementById('progress-label').textContent = `Вопрос ${current+1} из ${questions.length}`;
  document.getElementById('score-label').textContent = `✓ ${score}`;
  document.getElementById('progress-fill').style.width = `${(current / questions.length) * 100}%`;
  const navEl = document.getElementById('navInput');
  if (navEl) navEl.value = current + 1;

  const feedback = document.getElementById('feedback');
  feedback.className = 'feedback';
  
  const btnNext = document.getElementById('btn-next');
  btnNext.className = 'btn-next';
  btnNext.textContent = current < questions.length - 1 ? 'Следующий вопрос →' : 'Завершить тест →';

  const optionsEl = document.getElementById('options');
  optionsEl.innerHTML = '';

  q.opts.forEach((opt, i) => {
    const btn = document.createElement('button');
    btn.className = 'option';
    btn.textContent = opt;
    btn.onclick = isMulti ? () => toggleMulti(i) : () => selectAnswer(i);
    optionsEl.appendChild(btn);
  });

  // Если уже отвечали — восстановить и заблокировать
if (answeredQuestions[current] !== undefined) {
  answered = true;
  const prev = answeredQuestions[current];
  const opts = document.querySelectorAll('.option');
  opts.forEach(o => { o.disabled = true; });
  
  if (prev.type === 'multi') {
    // Для мультивыбора
    if (prev.isCorrect) {
      prev.correct.forEach(i => opts[i].classList.add('correct'));
      const fb = document.getElementById('feedback');
      fb.className = 'feedback correct-fb show';
      document.getElementById('feedback-icon').textContent = '✓';
      document.getElementById('feedback-text').textContent = 'Правильно!';
    } else {
      prev.chosen.forEach(i => opts[i].classList.add('wrong'));
      prev.correct.forEach(i => opts[i].classList.add('correct'));
      const fb = document.getElementById('feedback');
      fb.className = 'feedback wrong-fb show';
      document.getElementById('feedback-icon').textContent = '✗';
      document.getElementById('feedback-text').textContent = 'Правильные ответы: ' + prev.correct.map(i => q.opts[i]).join(', ');
    }
  } else {
    // Для обычного выбора
    if (prev.isCorrect) {
      opts[prev.chosen].classList.add('correct');
      const fb = document.getElementById('feedback');
      fb.className = 'feedback correct-fb show';
      document.getElementById('feedback-icon').textContent = '✓';
      document.getElementById('feedback-text').textContent = 'Правильно!';
    } else {
      opts[prev.chosen].classList.add('wrong');
      opts[prev.correct].classList.add('correct');
      const fb = document.getElementById('feedback');
      fb.className = 'feedback wrong-fb show';
      document.getElementById('feedback-icon').textContent = '✗';
      document.getElementById('feedback-text').textContent = 'Правильный ответ: ' + q.opts[prev.correct];
    }
  }
  document.getElementById('btn-next').classList.add('show');
}
// Показываем нужную кнопку (добавьте этот код в конец renderQuestion)
const submitBtn = document.getElementById('btn-submit-multi');
const nextBtn = document.getElementById('btn-next');

if (isMulti && !answered) {
  // Для мультивыбора пока неподтверждённого
  submitBtn.style.display = 'block';
  nextBtn.style.display = 'none';
} else if (isMulti && answered) {
  // Для мультивыбора уже отвеченного
  submitBtn.style.display = 'none';
  nextBtn.style.display = 'block';
} else {
  // Для обычных вопросов
  submitBtn.style.display = 'none';
  nextBtn.style.display = 'block';
}
}

// Переключение выбора для мультивыбора
function toggleMulti(index) {
  if (answered) return;
  const btn = document.querySelectorAll('.option')[index];
  btn.classList.toggle('selected');
  
  if (selectedMulti.includes(index)) {
    selectedMulti = selectedMulti.filter(i => i !== index);
  } else {
    selectedMulti.push(index);
  }
}

// Отправка мультивыбора
function submitMulti() {
  if (answered || !isMulti) return;
  
  const q = questions[current];
  const opts = document.querySelectorAll('.option');
  const correctMulti = [...q.multi].sort();
  const userMulti = [...selectedMulti].sort();
  
  const isCorrect = JSON.stringify(correctMulti) === JSON.stringify(userMulti);
  
  opts.forEach(o => o.disabled = true);
  
  if (isCorrect) {
    score++;
    correctMulti.forEach(i => opts[i].classList.add('correct'));
    showFeedback('correct', 'Правильно!');
  } else {
    selectedMulti.forEach(i => opts[i].classList.add('wrong'));
    correctMulti.forEach(i => opts[i].classList.add('correct'));
    showFeedback('wrong', `Правильные ответы: ${correctMulti.map(i => q.opts[i]).join(', ')}`);
  }
  
  answered = true;
  
  // СОХРАНЯЕМ ОТВЕТ ДЛЯ МУЛЬТИВЫБОРА
  answeredQuestions[current] = { 
    chosen: selectedMulti, 
    correct: q.multi, 
    isCorrect: isCorrect,
    type: 'multi'
  };
  
  document.getElementById('score-label').textContent = `✓ ${score}`;
  
  // Скрыть кнопку подтверждения
  document.getElementById('btn-submit-multi').style.display = 'none';
  
  // Показать кнопку следующего вопроса
  const nextBtn = document.getElementById('btn-next');
  nextBtn.style.display = 'block';
  nextBtn.classList.add('show');
  
  // Сохраняем ответ пользователя для детальных результатов
  userAnswers[current] = selectedMulti;
  userAnswersDetails[current] = {
    question: q.q,
    userAnswer: selectedMulti.map(i => q.opts[i]).join(', '),
    correctAnswer: q.multi.map(i => q.opts[i]).join(', '),
    isCorrect: isCorrect,
    type: 'multi'
  };
  
  sessionStorage.setItem('userAnswers', JSON.stringify(userAnswersDetails));
  saveQuiz(); // сохраняем прогресс
}

// Показ подсказки
function showFeedback(type, message) {
  const fb = document.getElementById('feedback');
  fb.className = `feedback ${type}-fb show`;
  document.getElementById('feedback-icon').textContent = type === 'correct' ? '✓' : '✗';
  document.getElementById('feedback-text').textContent = message;
}

function selectAnswer(chosen) {
  if (answered) return;
  
  const q = questions[current];
  const opts = document.querySelectorAll('.option');
  
  opts.forEach(o => o.disabled = true);
  
  const isCorrect = chosen === q.ans;
  
  if (isCorrect) {
    score++;
    opts[chosen].classList.add('correct');
    showFeedback('correct', 'Правильно!');
  } else {
    opts[chosen].classList.add('wrong');
    opts[q.ans].classList.add('correct');
    showFeedback('wrong', `Правильный ответ: ${q.opts[q.ans]}`);
  }
  
  answered = true;
  answeredQuestions[current] = { chosen: chosen, correct: q.ans, isCorrect: isCorrect };
  document.getElementById('score-label').textContent = `✓ ${score}`;
  document.getElementById('btn-next').classList.add('show');
  saveQuiz();
}

function nextQuestion() {
  current++;
  if (current >= questions.length) {
    showResult();
  } else {
    document.getElementById('question-card').style.animation = 'none';
    const navInput = document.getElementById('navInput');
    if (navInput) navInput.value = current + 1;
    setTimeout(() => {
      document.getElementById('question-card').style.animation = '';
      renderQuestion();
    }, 10);
  }
  saveQuiz();
}

function showResult() {
  document.getElementById('quiz-area').style.display = 'none';
  const result = document.getElementById('result-screen');
  result.className = 'result-screen show';
  result.innerHTML = '';

  const pct = Math.round((score / questions.length) * 100);
  
  let title, sub;
  if (pct >= 90) { title = 'Отлично!'; sub = `Вы ответили правильно на ${score} из ${questions.length} вопросов. Превосходный результат!`; }
  else if (pct >= 70) { title = 'Хорошо!'; sub = `Вы ответили правильно на ${score} из ${questions.length} вопросов. Хороший результат, есть куда расти.`; }
  else if (pct >= 50) { title = 'Удовлетворительно'; sub = `Вы ответили правильно на ${score} из ${questions.length} вопросов. Стоит повторить материал.`; }
  else { title = 'Нужно подготовиться'; sub = `Вы ответили правильно на ${score} из ${questions.length} вопросов. Рекомендуем изучить тему глубже.`; }

  // Собираем детали из answeredQuestions
  let detailsHTML = '';
  const keys = Object.keys(answeredQuestions).map(Number).sort((a,b) => a-b);
  
  if (keys.length === 0) {
    detailsHTML = '<p style="color: var(--muted); text-align: center; padding: 20px;">Нет сохраненных ответов.</p>';
  } else {
    for (const i of keys) {
      const item = answeredQuestions[i];
      const q = questions[i];
      if (!item || !q) continue;
      const statusColor = item.isCorrect ? 'var(--accent2)' : 'var(--wrong)';
      const statusIcon = item.isCorrect ? '✅' : '❌';
      const statusText = item.isCorrect ? 'Верно' : 'Неверно';
      detailsHTML += `
        <div style="margin-bottom: 15px; padding: 15px; background: var(--card); border-radius: 8px; border-left: 4px solid ${statusColor};">
          <div style="margin-bottom: 8px;"><span style="font-weight: bold; color: ${statusColor};">Вопрос ${i+1} ${statusIcon} ${statusText}</span></div>
          <div style="margin-bottom: 8px; font-size: 0.9rem;">${q.q}</div>
          <div style="color: var(--muted);">Ваш ответ: <span style="color: ${statusColor}; font-weight: bold;">${q.opts[item.chosen]}</span></div>
          ${!item.isCorrect ? `<div style="color: var(--accent2); margin-top: 5px;">✅ Правильный: ${q.opts[item.correct]}</div>` : ''}
        </div>`;
    }
  }

  // Собираем финальный HTML
  result.innerHTML = `
    <div class="result-circle" style="--pct: ${pct}%">
      <div class="result-score">${pct}%</div>
    </div>
    <div class="result-title">${title}</div>
    <div class="result-sub">${sub}</div>
    
    <div style="margin: 30px 0; text-align: left;">
      <h3 style="font-family: 'Unbounded'; margin-bottom: 20px; color: var(--accent2);">📋 Детальные результаты:</h3>
      <div style="max-height: 500px; overflow-y: auto; padding: 15px; background: var(--surface); border-radius: 10px; border: 1px solid var(--border);">
        ${detailsHTML}
      </div>
    </div>
    
    <button class="btn-restart" onclick="restartQuiz()">↺ Пройти заново</button>
  `;
}

function restartQuiz() {
  sessionStorage.removeItem('quizProgress');
  current = 0; score = 0; answered = false; answeredQuestions = {};
  document.getElementById('result-screen').className = 'result-screen';
  document.getElementById('quiz-area').style.display = 'block';
  document.getElementById('btn-next').textContent = 'Следующий вопрос →';
  const navEl = document.getElementById('navInput');
  if (navEl) navEl.value = 1;
  renderQuestion();
}

renderQuestion();
// Обновить счётчик после полной загрузки DOM (навигатор рендерится после скрипта)
document.addEventListener('DOMContentLoaded', function() {
  const navEl = document.getElementById('navInput');
  if (navEl) navEl.value = current + 1;
});
</script>
<!-- Блок навигации для перехода к любому вопросу -->
<div style="position: fixed; top: 10px; right: 10px; z-index: 1000; background: var(--card); border: 1px solid var(--border); border-radius: 50px; padding: 8px 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); display: flex; gap: 10px; align-items: center; backdrop-filter: blur(5px);">
  <button onclick="goToQuestion(0)" style="background: var(--accent); border: none; color: white; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-weight: bold; font-size: 16px;" title="Первый вопрос">⏮️</button>
  <button onclick="goToQuestion(current - 1)" style="background: var(--surface); border: 1px solid var(--border); color: var(--text); width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-weight: bold; font-size: 16px;" title="Предыдущий вопрос">◀</button>
  
  <div style="display: flex; align-items: center; gap: 5px; background: var(--surface); padding: 3px 10px; border-radius: 40px;">
    <input type="number" id="navInput" min="1" max="109" value="1" style="width: 50px; background: transparent; border: none; color: var(--text); font-family: 'JetBrains Mono'; font-size: 14px; text-align: center; outline: none; border-bottom: 1px solid var(--accent);">
    <span style="color: var(--muted); font-size: 14px;">/ 109</span>
  </div>
  
  <button onclick="goToQuestion(current + 1)" style="background: var(--surface); border: 1px solid var(--border); color: var(--text); width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-weight: bold; font-size: 16px;" title="Следующий вопрос">▶</button>
  <button onclick="goToQuestion(108)" style="background: var(--accent2); border: none; color: white; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-weight: bold; font-size: 16px;" title="Последний вопрос">⏭️</button>
</div>

<!-- Модальное окно для подтверждения перехода -->
<div id="navModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center;">
  <div style="background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 30px; max-width: 400px; text-align: center;">
    <div style="font-size: 40px; margin-bottom: 20px;">⚠️</div>
    <h3 style="font-family: 'Unbounded'; margin-bottom: 15px;">Перейти к вопросу <span id="modalQuestionNum"></span>?</h3>
    <p style="color: var(--muted); margin-bottom: 25px;">Текущий прогресс будет сохранён</p>
    <div style="display: flex; gap: 15px; justify-content: center;">
      <button onclick="confirmNavigation()" style="background: linear-gradient(135deg, var(--accent), #9f5ff5); border: none; color: white; padding: 12px 30px; border-radius: 10px; font-family: 'Unbounded'; cursor: pointer; font-weight: 700;">Перейти</button>
      <button onclick="closeModal()" style="background: var(--surface); border: 1px solid var(--border); color: var(--text); padding: 12px 30px; border-radius: 10px; font-family: 'Unbounded'; cursor: pointer; font-weight: 700;">Отмена</button>
    </div>
  </div>
</div>

<script>
// Функция для навигации по вопросам
let targetQuestion = 0;

function goToQuestion(index) {
  if (index < 0) index = 0;
  if (index >= questions.length) index = questions.length - 1;
  performNavigation(index);
}

function performNavigation(index) {
  if (index < 0 || index >= questions.length) return;
  
  current = index;
  
  // Анимация перехода
  document.getElementById('question-card').style.animation = 'none';
  setTimeout(() => {
    document.getElementById('question-card').style.animation = '';
    renderQuestion();
  }, 10);
  
  // Обновляем значение в поле ввода
  document.getElementById('navInput').value = current + 1;
}

function confirmNavigation() {
  closeModal();
  performNavigation(targetQuestion);
}

function closeModal() {
  document.getElementById('navModal').style.display = 'none';
}

// Обработчик ввода с клавиатуры
document.addEventListener('DOMContentLoaded', function() {
  const navInput = document.getElementById('navInput');
  if (navInput) {
    navInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        let val = parseInt(this.value);
        if (isNaN(val)) val = 1;
        if (val < 1) val = 1;
        if (val > questions.length) val = questions.length;
        
        goToQuestion(val - 1);
      }
    });
  }
});

// Добавляем обработчик клавиш для быстрой навигации
document.addEventListener('keydown', function(e) {
  // Alt + ← или Ctrl + ←
  if ((e.altKey || e.ctrlKey) && e.key === 'ArrowLeft') {
    e.preventDefault();
    goToQuestion(current - 1);
  }
  // Alt + → или Ctrl + →
  else if ((e.altKey || e.ctrlKey) && e.key === 'ArrowRight') {
    e.preventDefault();
    goToQuestion(current + 1);
  }
  // Alt + Home или Ctrl + Home
  else if ((e.altKey || e.ctrlKey) && e.key === 'Home') {
    e.preventDefault();
    goToQuestion(0);
  }
  // Alt + End или Ctrl + End
  else if ((e.altKey || e.ctrlKey) && e.key === 'End') {
    e.preventDefault();
    goToQuestion(questions.length - 1);
  }
});
</script>

<style>
/* Стили для поля ввода с браузерными стрелочками */
#navInput::-webkit-outer-spin-button,
#navInput::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
#navInput[type=number] {
  -moz-appearance: textfield;
}

/* Адаптив для мобильных */
@media (max-width: 600px) {
  /* Отступ сверху для контента, чтобы не перекрывало шапку */
  .container {
    margin-top: 70px;
  }
  
  /* Уменьшаем навигацию на мобильных */
  div[style*="position: fixed; top: 10px; right: 10px;"] {
    padding: 5px 10px;
    gap: 5px;
  }
  
  div[style*="position: fixed; top: 10px; right: 10px;"] button {
    width: 32px;
    height: 32px;
    font-size: 14px;
  }
  
  #navInput {
    width: 45px;
    font-size: 13px;
  }
}

/* Для очень маленьких экранов */
@media (max-width: 380px) {
  .container {
    margin-top: 80px;
  }
  
  div[style*="position: fixed; top: 10px; right: 10px;"] button {
    width: 28px;
    height: 28px;
    font-size: 12px;
  }
  
  #navInput {
    width: 40px;
    font-size: 12px;
  }
  
  span[style*="color: var(--muted);"] {
    font-size: 12px;
  }
}
</style>
</body>
</html>


